<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>SamPack Order</title>
    <style>
        :root { --primary: #2c3e50; --accent: #27ae60; --bg: #f8f9fa; --text: #333; }
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; background: var(--bg); margin: 0; padding-bottom: 100px; color: var(--text); -webkit-tap-highlight-color: transparent; }
        
        /* Header */
        .header { background: white; padding: 15px; position: sticky; top: 0; z-index: 100; box-shadow: 0 2px 10px rgba(0,0,0,0.1); display: flex; justify-content: space-between; align-items: center; }
        .logo { font-weight: 800; font-size: 1.3rem; color: var(--primary); display: flex; align-items: center; gap: 5px; }
        .lang-switch button { padding: 6px 12px; border: 1px solid var(--primary); background: white; border-radius: 6px; cursor: pointer; font-weight: 600; font-size: 0.9rem; }
        .lang-switch button.active { background: var(--primary); color: white; }

        /* Search & Filter */
        .tools-container { max-width: 800px; margin: 15px auto 5px; padding: 0 15px; }
        .search-box { width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 10px; font-size: 1rem; box-sizing: border-box; margin-bottom: 10px; outline: none; }
        .search-box:focus { border-color: var(--accent); }
        
        .filter-scroll { display: flex; gap: 10px; overflow-x: auto; padding-bottom: 5px; -webkit-overflow-scrolling: touch; scrollbar-width: none; }
        .filter-scroll::-webkit-scrollbar { display: none; }
        .filter-btn { padding: 8px 16px; background: white; border: 1px solid #ddd; border-radius: 20px; white-space: nowrap; cursor: pointer; font-size: 0.9rem; color: #555; }
        .filter-btn.active { background: var(--primary); color: white; border-color: var(--primary); }

        /* Products */
        .container { max-width: 800px; margin: 0 auto; padding: 0 15px; }
        .product-card { background: white; border-radius: 16px; padding: 15px; margin-bottom: 15px; display: flex; align-items: center; justify-content: space-between; box-shadow: 0 2px 8px rgba(0,0,0,0.04); border: 1px solid transparent; transition: border 0.2s; }
        .product-card.in-cart { border-color: var(--accent); background: #fdfdfd; }
        
        .prod-img { width: 60px; height: 60px; border-radius: 10px; object-fit: cover; margin-right: 15px; background: #eee; }
        .prod-info { flex: 1; min-width: 0; } /* min-width fix for text truncation */
        .prod-name { font-weight: 700; font-size: 1rem; margin-bottom: 4px; line-height: 1.3; }
        .prod-detail { font-size: 0.85rem; color: #888; display: flex; align-items: center; gap: 5px; }
        .prod-code { background: #eee; padding: 2px 6px; border-radius: 4px; font-size: 0.75rem; font-weight: bold; color: #555; }
        .prod-price { color: var(--accent); font-weight: 800; font-size: 1.1rem; margin-top: 6px; }

        /* Controls (Optimized) */
        .controls { display: flex; align-items: center; gap: 5px; background: #f1f3f5; padding: 4px; border-radius: 12px; }
        .btn-qty { width: 36px; height: 36px; border: none; background: white; border-radius: 10px; font-size: 20px; color: var(--primary); cursor: pointer; display: flex; align-items: center; justify-content: center; box-shadow: 0 2px 5px rgba(0,0,0,0.05); touch-action: manipulation; }
        .btn-qty:active { transform: scale(0.95); background: #eee; }
        
        /* Input for manual typing */
        .qty-input { width: 40px; height: 36px; border: none; background: transparent; text-align: center; font-weight: bold; font-size: 1.1rem; color: #333; -moz-appearance: textfield; padding: 0; }
        .qty-input::-webkit-outer-spin-button, .qty-input::-webkit-inner-spin-button { -webkit-appearance: none; margin: 0; }
        .qty-input:focus { outline: none; background: #e9ecef; border-radius: 6px; }

        /* Cart Bar */
        .cart-bar { position: fixed; bottom: 0; left: 0; right: 0; background: white; border-top: 1px solid #eee; padding: 15px 20px; display: flex; justify-content: space-between; align-items: center; box-shadow: 0 -4px 20px rgba(0,0,0,0.08); z-index: 200; backdrop-filter: blur(10px); background: rgba(255,255,255,0.95); }
        .cart-info { display: flex; flex-direction: column; }
        .cart-total { font-weight: 800; font-size: 1.2rem; color: var(--primary); }
        .cart-count { font-size: 0.85rem; color: #777; }
        .btn-checkout { background: var(--accent); color: white; border: none; padding: 12px 30px; border-radius: 30px; font-weight: 700; font-size: 1rem; cursor: pointer; box-shadow: 0 4px 15px rgba(39, 174, 96, 0.4); transition: transform 0.2s; }
        .btn-checkout:active { transform: scale(0.95); }

        /* Modal */
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.6); z-index: 1000; align-items: flex-end; justify-content: center; backdrop-filter: blur(3px); }
        .modal-content { background: white; width: 100%; max-width: 600px; padding: 25px; border-radius: 20px 20px 0 0; max-height: 90vh; overflow-y: auto; position: relative; animation: slideUp 0.3s ease-out; }
        @keyframes slideUp { from { transform: translateY(100%); } to { transform: translateY(0); } }
        
        .close-btn { position: absolute; right: 20px; top: 20px; font-size: 28px; color: #aaa; cursor: pointer; line-height: 1; }
        .modal h2 { margin-top: 0; color: var(--primary); }
        
        .form-group { margin-bottom: 20px; }
        .form-group label { display: block; margin-bottom: 8px; font-weight: 700; font-size: 0.9rem; color: #555; }
        .form-group input { width: 100%; padding: 14px; border: 2px solid #eee; border-radius: 12px; box-sizing: border-box; font-size: 1rem; transition: border 0.2s; }
        .form-group input:focus { border-color: var(--primary); outline: none; }
        
        .order-summary { background: #f8f9fa; padding: 15px; border-radius: 12px; margin-bottom: 25px; font-size: 0.95rem; max-height: 200px; overflow-y: auto; }
        .summary-row { display: flex; justify-content: space-between; margin-bottom: 8px; border-bottom: 1px dashed #e0e0e0; padding-bottom: 8px; }
        .summary-row:last-child { border: none; margin: 0; padding: 0; }

        .btn-whatsapp { background: #25D366; color: white; width: 100%; padding: 16px; border: none; border-radius: 14px; font-weight: 800; margin-bottom: 12px; cursor: pointer; font-size: 1.1rem; display: flex; align-items: center; justify-content: center; gap: 10px; }
        .btn-email { background: var(--primary); color: white; width: 100%; padding: 16px; border: none; border-radius: 14px; font-weight: 800; cursor: pointer; font-size: 1.1rem; display: flex; align-items: center; justify-content: center; gap: 10px; }
        
        .hidden { display: none !important; }
    </style>
</head>
<body>

<div class="header">
    <div class="logo">ðŸ“¦ SamPack</div>
    <div class="lang-switch">
        <button id="btn-de" class="active" onclick="setLang('de')">DE</button>
        <button id="btn-fr" onclick="setLang('fr')">FR</button>
    </div>
</div>

<div class="tools-container">
    <input type="text" id="searchInput" class="search-box" placeholder="Suchen / Search..." oninput="filterProducts()">
    <div class="filter-scroll" id="categoryFilters">
        </div>
</div>

<div class="container" id="product-list">
    </div>

<div class="cart-bar" id="cartBar" style="display:none">
    <div class="cart-info">
        <span class="cart-total"><span id="total-price">0.00</span> CHF</span>
        <span class="cart-count" id="item-count">0 Artikel</span>
    </div>
    <button class="btn-checkout" onclick="openCheckout()" id="lbl-view-cart">Warenkorb ></button>
</div>

<div class="modal" id="checkoutModal">
    <div class="modal-content">
        <span class="close-btn" onclick="closeCheckout()">&times;</span>
        <h2 id="lbl-checkout-title">Bestellung</h2>
        
        <div class="order-summary" id="order-summary"></div>

        <div class="form-group">
            <label id="lbl-name">Firma / Name *</label>
            <input type="text" id="customerName" placeholder="...">
        </div>
        <div class="form-group">
            <label id="lbl-address">Adresse</label>
            <input type="text" id="customerAddress" placeholder="...">
        </div>
        <div class="form-group">
            <label id="lbl-date">Datum</label>
            <input type="date" id="deliveryDate">
        </div>

        <button class="btn-whatsapp" onclick="sendWhatsapp()">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor"><path d="M12.031 6.172c-3.181 0-5.767 2.586-5.768 5.766-.001 1.298.38 2.27 1.019 3.287l-.711 2.598 2.654-.698c.99.54 1.743.836 2.808.836h.006c3.181 0 5.768-2.587 5.768-5.771 0-1.539-.599-2.99-1.687-4.081s-2.535-1.696-4.089-1.697zm6.09 9.92c-.31.867-1.742 1.638-2.368 1.693-.538.048-1.253.253-3.692-.72-2.369-.945-3.882-3.344-4.002-3.504-.119-.16-1.15-1.526-1.15-2.915s.709-2.185 1.258-2.618c.2-.158.468-.225.755-.225.21 0 .428.02.602.1.186.085.62.998.795 1.439.145.367.149.615.015.89-.136.276-.41.597-.624.815-.178.18-.396.34-.143.774.25.431 1.11 1.838 2.383 2.971.492.438.922.756 1.25.915.328.16.71.134 1.025-.23.23-.267.97-1.135 1.229-1.524.258-.39.516-.329.865-.2.349.129 2.204 1.04 2.582 1.229.379.189.63.28.719.435.09.156.09 2.333-.306 3.199z"/></svg>
            WhatsApp
        </button>
        <button class="btn-email" onclick="sendEmail()">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"/><polyline points="22,6 12,13 2,6"/></svg>
            Email
        </button>
    </div>
</div>

<script>
    // --- YOUR DATA HERE (Paste from Excel later) ---
    const products = [
        { id: "002", cat: "Food", nameDE: "Pommes Frites (7mm)", nameFR: "Pommes Frites (7mm)", price: 3.50, unit: "kg" },
        { id: "009", cat: "Food", nameDE: "HÃ¤hnchenbrust", nameFR: "Poitrine de poulet", price: 94.00, unit: "Box" },
        { id: "2070", cat: "Packaging", nameDE: "Aluminiumfolie 14mm", nameFR: "Papier aluminium 14mm", price: 25.00, unit: "Pack" },
        { id: "2032A", cat: "Packaging", nameDE: "Frischhaltefolie 45cm", nameFR: "Film alimentaire 45cm", price: 45.00, unit: "Stk" },
        { id: "sauce", cat: "Packaging", nameDE: "Saucenschalen 50ml", nameFR: "Pots Ã  sauce 50ml", price: 45.00, unit: "Box" },
        { id: "16750", cat: "Packaging", nameDE: "Lunch-Box IP 9 Weiss", nameFR: "BoÃ®te repas IP 9 Blanc", price: 38.00, unit: "Pack" },
        { id: "bags", cat: "Packaging", nameDE: "Bestecktaschen Creme", nameFR: "Pochettes couverts CrÃ¨me", price: 60.00, unit: "Pack" },
        { id: "101", cat: "Food", nameDE: "Ketchup Sachets", nameFR: "Ketchup Sachets", price: 15.50, unit: "Box" },
        { id: "102", cat: "Food", nameDE: "Mayonnaise Sachets", nameFR: "Mayonnaise Sachets", price: 16.00, unit: "Box" },
        { id: "305", cat: "Packaging", nameDE: "Pizza Karton 32cm", nameFR: "BoÃ®te Ã  pizza 32cm", price: 22.00, unit: "Pack" }
    ];

    const translations = {
        de: { view_cart: "Warenkorb >", checkout_title: "Bestellung prÃ¼fen", name: "Firmenname / Ihr Name", address: "Lieferadresse", date: "Lieferdatum", items: "Artikel", whatsapp_msg: "Neue Bestellung:", email_sent: "Bestellung gesendet!", fill_all: "Bitte Namen eingeben!", all: "Alle" },
        fr: { view_cart: "Panier >", checkout_title: "VÃ©rifier la commande", name: "Nom de l'entreprise", address: "Adresse de livraison", date: "Date de livraison", items: "Articles", whatsapp_msg: "Nouvelle commande :", email_sent: "Commande envoyÃ©e !", fill_all: "Nom requis !", all: "Tous" }
    };

    let cart = {};
    let currentLang = 'de';
    let currentCat = 'all';

    function init() {
        renderCategories();
        renderProducts();
        document.getElementById('deliveryDate').valueAsDate = new Date();
    }

    function setLang(lang) {
        currentLang = lang;
        document.getElementById('btn-de').className = lang === 'de' ? 'active' : '';
        document.getElementById('btn-fr').className = lang === 'fr' ? 'active' : '';
        
        // Update labels
        const t = translations[lang];
        document.getElementById('lbl-view-cart').innerText = t.view_cart;
        document.getElementById('lbl-checkout-title').innerText = t.checkout_title;
        document.getElementById('lbl-name').innerText = t.name;
        document.getElementById('lbl-address').innerText = t.address;
        document.getElementById('lbl-date').innerText = t.date;
        document.getElementById('searchInput').placeholder = lang === 'de' ? "Suchen..." : "Rechercher...";
        
        renderCategories(); // Update cat names
        renderProducts();   // Update prod names
    }

    function renderCategories() {
        const cats = [...new Set(products.map(p => p.cat))];
        const container = document.getElementById('categoryFilters');
        const t = translations[currentLang];
        
        let html = `<button class="filter-btn ${currentCat === 'all' ? 'active' : ''}" onclick="filterCat('all')">${t.all}</button>`;
        cats.forEach(c => {
            html += `<button class="filter-btn ${currentCat === c ? 'active' : ''}" onclick="filterCat('${c}')">${c}</button>`;
        });
        container.innerHTML = html;
    }

    function filterCat(cat) {
        currentCat = cat;
        renderCategories();
        filterProducts();
    }

    function filterProducts() {
        const query = document.getElementById('searchInput').value.toLowerCase();
        const cards = document.querySelectorAll('.product-card');
        
        cards.forEach(card => {
            const cat = card.getAttribute('data-cat');
            const name = card.getAttribute('data-name').toLowerCase();
            const id = card.getAttribute('data-id').toLowerCase();
            
            const matchesSearch = name.includes(query) || id.includes(query);
            const matchesCat = currentCat === 'all' || currentCat === cat;

            if (matchesSearch && matchesCat) {
                card.classList.remove('hidden');
            } else {
                card.classList.add('hidden');
            }
        });
    }

    function renderProducts() {
        const container = document.getElementById('product-list');
        container.innerHTML = "";
        
        products.forEach(p => {
            const name = currentLang === 'de' ? p.nameDE : p.nameFR;
            const qty = cart[p.id] || 0;
            const imgPath = `https://niksampack.github.io/images/${p.id}.jpg`; // Placeholder logic
            
            // Note: input type='number' replaces the div
            const html = `
            <div class="product-card ${qty > 0 ? 'in-cart' : ''}" data-cat="${p.cat}" data-name="${name}" data-id="${p.id}" id="card-${p.id}">
                <div class="prod-info">
                    <div class="prod-name">${name}</div>
                    <div class="prod-detail"><span class="prod-code">#${p.id}</span> ${p.unit}</div>
                    <div class="prod-price">${p.price.toFixed(2)}</div>
                </div>
                <div class="controls">
                    <button class="btn-qty" onclick="changeQty('${p.id}', -1)">-</button>
                    <input type="number" class="qty-input" id="qty-${p.id}" value="${qty > 0 ? qty : ''}" placeholder="0" onchange="manualQty('${p.id}', this.value)">
                    <button class="btn-qty" onclick="changeQty('${p.id}', 1)">+</button>
                </div>
            </div>`;
            container.innerHTML += html;
        });
    }

    // --- Optimized Cart Logic ---
    function changeQty(id, delta) {
        if (!cart[id]) cart[id] = 0;
        cart[id] += delta;
        if (cart[id] <= 0) delete cart[id];
        
        updateUI(id);
    }

    function manualQty(id, val) {
        const num = parseInt(val);
        if (isNaN(num) || num <= 0) {
            delete cart[id];
        } else {
            cart[id] = num;
        }
        updateUI(id);
    }

    function updateUI(id) {
        // Only update specific elements, NOT the whole list!
        const input = document.getElementById(`qty-${id}`);
        const card = document.getElementById(`card-${id}`);
        
        if (input) input.value = cart[id] ? cart[id] : '';
        
        if (cart[id]) {
            card.classList.add('in-cart');
        } else {
            card.classList.remove('in-cart');
        }
        updateCartBar();
    }

    function updateCartBar() {
        let total = 0;
        let count = 0;
        for (const [id, qty] of Object.entries(cart)) {
            const p = products.find(x => x.id === id);
            if(p) {
                total += p.price * qty;
                count += qty;
            }
        }
        
        const bar = document.getElementById('cartBar');
        if (count > 0) {
            bar.style.display = 'flex';
            document.getElementById('total-price').innerText = total.toFixed(2);
            document.getElementById('item-count').innerText = `${count} ${translations[currentLang].items}`;
        } else {
            bar.style.display = 'none';
        }
    }

    // --- Checkout & Send ---
    function openCheckout() {
        renderCartSummary();
        document.getElementById('checkoutModal').style.display = 'flex';
    }
    function closeCheckout() { document.getElementById('checkoutModal').style.display = 'none'; }

    function renderCartSummary() {
        const div = document.getElementById('order-summary');
        div.innerHTML = "";
        let total = 0;
        for (const [id, qty] of Object.entries(cart)) {
            const p = products.find(x => x.id === id);
            const name = currentLang === 'de' ? p.nameDE : p.nameFR;
            const lineTotal = p.price * qty;
            total += lineTotal;
            div.innerHTML += `
            <div class="summary-row">
                <span style="font-weight:bold">${qty}x</span>
                <span style="flex:1; margin:0 10px">${name} <small>(#${p.id})</small></span>
                <span>${lineTotal.toFixed(2)}</span>
            </div>`;
        }
        div.innerHTML += `<div style="text-align:right; font-weight:800; margin-top:15px; border-top:1px solid #ddd; padding-top:10px;">Total: ${total.toFixed(2)} CHF</div>`;
    }

    function getOrderText() {
        const name = document.getElementById('customerName').value;
        const address = document.getElementById('customerAddress').value;
        const date = document.getElementById('deliveryDate').value;
        const t = translations[currentLang];
        
        let text = `*${t.whatsapp_msg}*\n`;
        text += `ðŸ‘¤ ${name}\nðŸ“ ${address}\nðŸ“… ${date}\n\n`;
        
        let total = 0;
        for (const [id, qty] of Object.entries(cart)) {
            const p = products.find(x => x.id === id);
            const pName = currentLang === 'de' ? p.nameDE : p.nameFR;
            // FIXED: Added Qty and ID explicitly
            text += `â–ªï¸ ${qty}x ${pName} [Code:${p.id}]\n`;
            total += p.price * qty;
        }
        text += `\n*Total: ${total.toFixed(2)} CHF*`;
        return text;
    }

    function sendWhatsapp() {
        const name = document.getElementById('customerName').value;
        if (!name) return alert(translations[currentLang].fill_all);
        
        // *** YOUR PHONE NUMBER ***
        const myNumber = "41783249525"; 
        
        const text = encodeURIComponent(getOrderText());
        window.open(`https://wa.me/${myNumber}?text=${text}`, '_blank');
    }

    async function sendEmail() {
        const name = document.getElementById('customerName').value;
        if (!name) return alert(translations[currentLang].fill_all);
        const btn = document.querySelector('.btn-email');
        const oldText = btn.innerHTML;
        btn.disabled = true; btn.innerHTML = "...";

        try {
            const formData = new FormData();
            // *** YOUR ACCESS KEY ***
            formData.append("access_key", "01c92836-701d-4faf-91b9-3836ee825485"); 

            formData.append("subject", `Bestellung: ${name}`);
            formData.append("message", getOrderText());
            const res = await fetch("https://api.web3forms.com/submit", { method: "POST", body: formData });
            if (res.ok) {
                alert(translations[currentLang].email_sent);
                closeCheckout();
                cart = {};
                products.forEach(p => updateUI(p.id)); // Reset UI
            } else { alert("Error."); }
        } catch (e) { alert("Error."); }
        btn.disabled = false; btn.innerHTML = oldText;
    }

    init();
</script>
</body>
</html>
