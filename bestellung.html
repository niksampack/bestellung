<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SamPack Online Order</title>
    <style>
        :root { --primary: #2c3e50; --accent: #27ae60; --bg: #f8f9fa; --text: #333; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: var(--bg); margin: 0; padding-bottom: 80px; color: var(--text); }
        
        /* Header */
        .header { background: white; padding: 15px; position: sticky; top: 0; z-index: 100; box-shadow: 0 2px 10px rgba(0,0,0,0.1); display: flex; justify-content: space-between; align-items: center; }
        .logo { font-weight: bold; font-size: 1.2rem; color: var(--primary); }
        .lang-switch button { padding: 5px 10px; border: 1px solid var(--primary); background: white; border-radius: 5px; cursor: pointer; font-weight: bold; }
        .lang-switch button.active { background: var(--primary); color: white; }

        /* Products */
        .container { max-width: 800px; margin: 20px auto; padding: 0 15px; }
        .category-title { margin-top: 30px; border-bottom: 2px solid #ddd; padding-bottom: 5px; color: var(--primary); font-weight: bold; }
        
        .product-card { background: white; border-radius: 12px; padding: 15px; margin-bottom: 15px; display: flex; align-items: center; justify-content: space-between; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
        .prod-info { flex: 1; }
        .prod-name { font-weight: bold; font-size: 1rem; margin-bottom: 4px; }
        .prod-detail { font-size: 0.85rem; color: #777; }
        .prod-price { color: var(--accent); font-weight: bold; margin-top: 5px; }

        .controls { display: flex; align-items: center; gap: 10px; background: #f1f3f5; padding: 5px; border-radius: 8px; }
        .btn-qty { width: 30px; height: 30px; border: none; background: white; border-radius: 50%; font-size: 18px; color: var(--primary); cursor: pointer; display: flex; align-items: center; justify-content: center; box-shadow: 0 1px 3px rgba(0,0,0,0.1); }
        .qty-val { font-weight: bold; min-width: 20px; text-align: center; }

        /* Cart Bar */
        .cart-bar { position: fixed; bottom: 0; left: 0; right: 0; background: white; border-top: 1px solid #ddd; padding: 15px; display: flex; justify-content: space-between; align-items: center; box-shadow: 0 -2px 10px rgba(0,0,0,0.1); z-index: 200; }
        .cart-total { font-weight: bold; font-size: 1.1rem; }
        .btn-checkout { background: var(--accent); color: white; border: none; padding: 12px 25px; border-radius: 25px; font-weight: bold; font-size: 1rem; cursor: pointer; }

        /* Modal */
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1000; align-items: center; justify-content: center; }
        .modal-content { background: white; width: 90%; max-width: 500px; padding: 25px; border-radius: 15px; max-height: 90vh; overflow-y: auto; position: relative; }
        .close-btn { position: absolute; right: 20px; top: 15px; font-size: 24px; cursor: pointer; }
        
        .form-group { margin-bottom: 15px; }
        .form-group label { display: block; margin-bottom: 5px; font-weight: bold; font-size: 0.9rem; }
        .form-group input { width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 8px; box-sizing: border-box; }
        
        .order-summary { background: #f8f9fa; padding: 10px; border-radius: 8px; margin-bottom: 20px; font-size: 0.9rem; }
        .summary-row { display: flex; justify-content: space-between; margin-bottom: 5px; border-bottom: 1px dashed #eee; padding-bottom: 5px; }

        .btn-whatsapp { background: #25D366; color: white; width: 100%; padding: 15px; border: none; border-radius: 10px; font-weight: bold; margin-bottom: 10px; cursor: pointer; font-size: 1rem; }
        .btn-email { background: var(--primary); color: white; width: 100%; padding: 15px; border: none; border-radius: 10px; font-weight: bold; cursor: pointer; font-size: 1rem; }
    </style>
</head>
<body>

<div class="header">
    <div class="logo">ðŸ“¦ SamPack Order</div>
    <div class="lang-switch">
        <button id="btn-de" class="active" onclick="setLang('de')">DE</button>
        <button id="btn-fr" onclick="setLang('fr')">FR</button>
    </div>
</div>

<div class="container" id="product-list"></div>

<div class="cart-bar">
    <div class="cart-total">
        <span id="total-price">0.00</span> CHF
        <div style="font-size: 0.8rem; color: #777;" id="item-count">0 Artikel</div>
    </div>
    <button class="btn-checkout" onclick="openCheckout()" id="lbl-view-cart">Warenkorb</button>
</div>

<div class="modal" id="checkoutModal">
    <div class="modal-content">
        <span class="close-btn" onclick="closeCheckout()">&times;</span>
        <h2 id="lbl-checkout-title" style="margin-top:0">Bestellung abschlieÃŸen</h2>
        
        <div class="order-summary" id="order-summary"></div>

        <div class="form-group">
            <label id="lbl-name">Firmenname / Ihr Name</label>
            <input type="text" id="customerName" placeholder="...">
        </div>
        <div class="form-group">
            <label id="lbl-address">Adresse</label>
            <input type="text" id="customerAddress" placeholder="...">
        </div>
        <div class="form-group">
            <label id="lbl-date">Lieferdatum</label>
            <input type="date" id="deliveryDate">
        </div>

        <button class="btn-whatsapp" onclick="sendWhatsapp()">ðŸ“± WhatsApp</button>
        <button class="btn-email" onclick="sendEmail()">ðŸ“§ Email</button>
    </div>
</div>

<script>
    // --- ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ù…Ø­ØµÙˆÙ„Ø§Øª ---
    const products = [
        { id: "2070", cat: "packaging", nameDE: "Aluminiumfolie 14mm (4 Stk.)", nameFR: "Papier aluminium 14mm (4 pcs)", price: 25.00, unit: "Packung" },
        { id: "2032A", cat: "packaging", nameDE: "Frischhaltefolie 45cm", nameFR: "Film alimentaire 45cm", price: 45.00, unit: "Stk." },
        { id: "sauce", cat: "packaging", nameDE: "Saucenschalen 50ml (1000 Stk.)", nameFR: "Pots Ã  sauce 50ml (1000 pcs)", price: 45.00, unit: "Packung" },
        { id: "16750", cat: "packaging", nameDE: "Lunch-Box IP 9 Weiss", nameFR: "BoÃ®te repas IP 9 Blanc", price: 38.00, unit: "Packung" },
        { id: "bags", cat: "packaging", nameDE: "Bestecktaschen Creme", nameFR: "Pochettes couverts CrÃ¨me", price: 60.00, unit: "Packung" },
        { id: "002", cat: "food", nameDE: "Pommes Frites Fine Quality (7mm)", nameFR: "Pommes Frites (7mm)", price: 3.50, unit: "kg" },
        { id: "009", cat: "food", nameDE: "HÃ¤hnchenbrust (12kg Box)", nameFR: "Poitrine de poulet (Box 12kg)", price: 94.00, unit: "Box" }
    ];

    const translations = {
        de: { cat_packaging: "Verpackung", cat_food: "Lebensmittel", view_cart: "Bestellen >", checkout_title: "Bestellung prÃ¼fen", name: "Firmenname / Kontakt", address: "Lieferadresse", date: "GewÃ¼nschtes Datum", items: "Artikel", whatsapp_msg: "Hallo, hier ist eine neue Bestellung:", email_sent: "Bestellung erfolgreich gesendet!", fill_all: "Bitte Namen eingeben!" },
        fr: { cat_packaging: "Emballage", cat_food: "Alimentation", view_cart: "Commander >", checkout_title: "VÃ©rifier la commande", name: "Nom de l'entreprise / Contact", address: "Adresse de livraison", date: "Date souhaitÃ©e", items: "Articles", whatsapp_msg: "Bonjour, voici une nouvelle commande :", email_sent: "Commande envoyÃ©e avec succÃ¨s !", fill_all: "Veuillez entrer votre nom !" }
    };

    let cart = {};
    let currentLang = 'de';

    function init() { renderProducts(); document.getElementById('deliveryDate').valueAsDate = new Date(); }

    function setLang(lang) {
        currentLang = lang;
        document.getElementById('btn-de').className = lang === 'de' ? 'active' : '';
        document.getElementById('btn-fr').className = lang === 'fr' ? 'active' : '';
        document.getElementById('lbl-view-cart').innerText = translations[lang].view_cart;
        document.getElementById('lbl-checkout-title').innerText = translations[lang].checkout_title;
        document.getElementById('lbl-name').innerText = translations[lang].name;
        document.getElementById('lbl-address').innerText = translations[lang].address;
        document.getElementById('lbl-date').innerText = translations[lang].date;
        renderProducts();
        if(document.getElementById('checkoutModal').style.display === 'flex') renderCartSummary();
    }

    function renderProducts() {
        const container = document.getElementById('product-list');
        container.innerHTML = "";
        const cats = { packaging: [], food: [] };
        products.forEach(p => cats[p.cat].push(p));
        const t = translations[currentLang];

        const createSection = (key, title) => {
            if (cats[key].length === 0) return;
            container.innerHTML += `<div class="category-title">${title}</div>`;
            cats[key].forEach(p => {
                const qty = cart[p.id] || 0;
                const name = currentLang === 'de' ? p.nameDE : p.nameFR;
                container.innerHTML += `
                <div class="product-card">
                    <div class="prod-info">
                        <div class="prod-name">${name}</div>
                        <div class="prod-detail">${p.unit} - Code: ${p.id}</div>
                        <div class="prod-price">${p.price.toFixed(2)} CHF</div>
                    </div>
                    <div class="controls">
                        <button class="btn-qty" onclick="updateCart('${p.id}', -1)">-</button>
                        <div class="qty-val">${qty}</div>
                        <button class="btn-qty" onclick="updateCart('${p.id}', 1)">+</button>
                    </div>
                </div>`;
            });
        };
        createSection('packaging', t.cat_packaging);
        createSection('food', t.cat_food);
    }

    function updateCart(id, change) {
        if (!cart[id]) cart[id] = 0;
        cart[id] += change;
        if (cart[id] <= 0) delete cart[id];
        renderProducts();
        updateCartBar();
    }

    function updateCartBar() {
        let total = 0; let count = 0;
        for (const [id, qty] of Object.entries(cart)) {
            const p = products.find(x => x.id === id);
            if(p) { total += p.price * qty; count += qty; }
        }
        document.getElementById('total-price').innerText = total.toFixed(2);
        document.getElementById('item-count').innerText = `${count} ${translations[currentLang].items}`;
    }

    function openCheckout() {
        if (Object.keys(cart).length === 0) return;
        renderCartSummary();
        document.getElementById('checkoutModal').style.display = 'flex';
    }
    function closeCheckout() { document.getElementById('checkoutModal').style.display = 'none'; }

    function renderCartSummary() {
        const div = document.getElementById('order-summary');
        div.innerHTML = "";
        let total = 0;
        for (const [id, qty] of Object.entries(cart)) {
            const p = products.find(x => x.id === id);
            const name = currentLang === 'de' ? p.nameDE : p.nameFR;
            const lineTotal = p.price * qty;
            total += lineTotal;
            div.innerHTML += `<div class="summary-row"><span>${qty}x ${name}</span><span>${lineTotal.toFixed(2)}</span></div>`;
        }
        div.innerHTML += `<div style="text-align:right; font-weight:bold; margin-top:10px; border-top:1px solid #ddd; padding-top:5px;">Total: ${total.toFixed(2)} CHF</div>`;
    }

    function getOrderText() {
        const name = document.getElementById('customerName').value;
        const address = document.getElementById('customerAddress').value;
        const date = document.getElementById('deliveryDate').value;
        const t = translations[currentLang];
        
        let text = `*${t.whatsapp_msg}*\n\n`;
        text += `ðŸ‘¤: ${name}\nðŸ“: ${address}\nðŸ“…: ${date}\n\n`;
        let total = 0;
        for (const [id, qty] of Object.entries(cart)) {
            const p = products.find(x => x.id === id);
            const pName = currentLang === 'de' ? p.nameDE : p.nameFR;
            text += `${qty}x ${pName} \n`;
            total += p.price * qty;
        }
        text += `----------------\n*Total: ${total.toFixed(2)} CHF*`;
        return text;
    }

    function sendWhatsapp() {
        const name = document.getElementById('customerName').value;
        if (!name) return alert(translations[currentLang].fill_all);
        
        // Ø´Ù…Ø§Ø±Ù‡ Ù…ÙˆØ¨Ø§ÛŒÙ„ Ø´Ù…Ø§ Ø«Ø¨Øª Ø´Ø¯
        const myNumber = "41783249525"; 
        
        const text = encodeURIComponent(getOrderText());
        window.open(`https://wa.me/${myNumber}?text=${text}`, '_blank');
    }

    async function sendEmail() {
        const name = document.getElementById('customerName').value;
        if (!name) return alert(translations[currentLang].fill_all);
        const btn = document.querySelector('.btn-email');
        const oldText = btn.innerText;
        btn.disabled = true; btn.innerText = "...";

        try {
            const formData = new FormData();
            
            // *** ØªÙˆØ¬Ù‡: Ú©Ù„ÛŒØ¯ Ø¬Ø¯ÛŒØ¯ Ø±Ø§ Ø§ÛŒÙ†Ø¬Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù† ***
            formData.append("access_key", "01c92836-701d-4faf-91b9-3836ee825485"); 

            formData.append("subject", `New Order: ${name}`);
            formData.append("message", getOrderText());
            const res = await fetch("https://api.web3forms.com/submit", { method: "POST", body: formData });
            if (res.ok) {
                alert(translations[currentLang].email_sent);
                closeCheckout();
                cart = {};
                renderProducts();
                updateCartBar();
            } else { alert("Error sending email."); }
        } catch (e) { alert("Connection error."); }
        btn.disabled = false; btn.innerText = oldText;
    }

    init();
</script>
</body>
</html>

